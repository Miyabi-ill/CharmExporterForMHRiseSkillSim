# データフォーマット

お守り1個の例を記載しています。お守りが2個でもヘッダーやフッターがあるわけではないので、単純に結合して構いません。
実装例として[Pythonのコード](encode_example.py)もあります。

1. お守りは次のようなバイト列で表されます。※それぞれの詳細は後で説明

| 値または値の説明 |
| ---- |
| 0x0A |
| お守りバイト列の長さ |
| 0x0A |
| スキル1の長さ |
| 0x0A |
| スキル1文字列の長さ |
| スキル1文字列をutf-8エンコードしたもの(バイト列) |
| 0x10 |
| スキル1レベル |
| (スキル2情報はなければここから省略可能)0x0A |
| スキル2の長さ |
| 0x0A |
| スキル2文字列の長さ |
| スキル2文字列をutf-8エンコードしたもの(バイト列) |
| 0x10 |
| スキル2レベル(ここまでスキル2情報) |
| 0x1A |
| スロット情報の長さ |
| (スロットがなければここから省略可能)0x08 |
| スロット1空き |
| 0x10 |
| スロット2空き |
| 0x18 |
| スロット3空き |

2. 複数のお守りがある際でも、単純にお守り列をつなぎ合わせたバイト列で表現します。

例：[ お守り1, お守り2, お守り3... ]

3. 作成したバイト列をBase64エンコードします。完了！

例：CiAKHAoY44K544K/44Of44OK5oCl6YCf5Zue5b6pEAEaAA==

### データフォーマット詳細

具体的な例を挙げて説明します。

`スタミナ急速回復1、ジャンプ鉄人1、スロット3-2-1`のお守りについて考えます。
1. まず、"スタミナ急速回復"をutf-8エンコードします。(スキル1文字列をutf-8エンコードしたもの)

<pre>[0xe3, 0x82, 0xb9, 0xe3, 0x82, 0xbf, 0xe3, 0x83, 0x9f, 0xe3, 0x83, 0x8a, 0xe6, 0x80, 0xa5, 0xe9, 0x80, 0x9f, 0xe5, 0x9b, 0x9e, 0xe5, 0xbe, 0xa9]</pre>

2. このバイト列の長さ(24 = 0x18)を取得し、先頭に追加します。これの手前に必ず0x0Aが入るので、これも追加します。(0x0A, スキル1文字列の長さ)

<pre>[<b>0x0a, 0x18</b>, 0xe3, 0x82, 0xb9, 0xe3, 0x82, 0xbf, 0xe3, 0x83, 0x9f, 0xe3, 0x83, 0x8a, 0xe6, 0x80, 0xa5, 0xe9, 0x80, 0x9f, 0xe5, 0x9b, 0x9e, 0xe5, 0xbe, 0xa9]</pre>

3. スキルレベル(1 = 0x01)を末尾に追加します。スキルレベルの手前に0x10が必要なので、それもまとめて追加します。(0x10, スキル1レベル)

<pre>[0x0a, 0x18, 0xe3, 0x82, 0xb9, 0xe3, 0x82, 0xbf, 0xe3, 0x83, 0x9f, 0xe3, 0x83, 0x8a, 0xe6, 0x80, 0xa5, 0xe9, 0x80, 0x9f, 0xe5, 0x9b, 0x9e, 0xe5, 0xbe, 0xa9, <b>0x10, 0x01</b>]</pre>

4. 0x0Aとスキル1全体の長さ(28 = 0x1C = 24 + 4 = スキル1文字列の長さ + 4)を先頭に追加します(0x0A, スキル1全体の長さ)。ここまでで1個のスキルのエンコードができました。

<pre>[<b>0x0a, 0x1c</b>, 0x0a, 0x18, 0xe3, 0x82, 0xb9, 0xe3, 0x82, 0xbf, 0xe3, 0x83, 0x9f, 0xe3, 0x83, 0x8a, 0xe6, 0x80, 0xa5, 0xe9, 0x80, 0x9f, 0xe5, 0x9b, 0x9e, 0xe5, 0xbe, 0xa9, 0x10, 0x01]</pre>

5. スキル2も同様にエンコードします。スキル1のバイト列は省略しています。

"ジャンプ鉄人"をutf-8エンコードします。

<pre>[0xe3, 0x82, 0xb8, 0xe3, 0x83, 0xa3, 0xe3, 0x83, 0xb3, 0xe3, 0x83, 0x97, 0xe9, 0x89, 0x84, 0xe4, 0xba, 0xba]</pre>


0x0A, バイト列の長さ(18 = 0x12)を追加します。

<pre>[<b>0x0a, 0x12</b>, 0xe3, 0x82, 0xb8, 0xe3, 0x83, 0xa3, 0xe3, 0x83, 0xb3, 0xe3, 0x83, 0x97, 0xe9, 0x89, 0x84, 0xe4, 0xba, 0xba]</pre>


0x10, スキルレベル(2 = 0x02)を追加します。

<pre>[0x0a, 0x12, 0xe3, 0x82, 0xb8, 0xe3, 0x83, 0xa3, 0xe3, 0x83, 0xb3, 0xe3, 0x83, 0x97, 0xe9, 0x89, 0x84, 0xe4, 0xba, 0xba, <b>0x10, 0x02</b>]</pre>


0x0A, スキル2全体の長さ(18 + 4 = 0x16)を追加します。

<pre>[<b>0x0a, 0x16</b>, 0x0a, 0x12, 0xe3, 0x82, 0xb8, 0xe3, 0x83, 0xa3, 0xe3, 0x83, 0xb3, 0xe3, 0x83, 0x97, 0xe9, 0x89, 0x84, 0xe4, 0xba, 0xba, 0x10, 0x02]</pre>


6. スロット情報を追加します。スキル1と2のバイト列は省略しています。

今回はスロットが3か所あるため、スロット全体の長さは3x2 = 6となります。もしスロットが空いていなければ(0-0-0の場合)0、1か所(1-0-0など)ならば2、2か所(2-1-0など)ならば4となります。
0x1aとスロット全体の長さを追加し
<pre>[<b>0x1a, 0x06</b>]</pre>

7. 1個目のスロットを追加します。

末尾に0x08とスロットレベル(3)を追加します。
<pre>[0x1a, 0x06, <b>0x08, 0x03</b>]</pre>

8. 2個目のスロットを追加します。

末尾に0x10とスロットレベル(2)を追加します。
<pre>[0x1a, 0x06, 0x08, 0x03, <b>0x10, 0x02</b>]</pre>

9. 3個目のスロットを追加します。

末尾に0x18とスロットレベル(1)を追加します。
<pre>[0x1a, 0x06, 0x08, 0x03, 0x10, 0x02, <b>0x18, 0x01</b>]</pre>

10. スキル1、スキル2、スロットを全てつなげ合わせます。
`[スキル1, スキル2, スロット]`
となるようにします。

<pre>[0x0a, 0x1c, 0x0a, 0x18, 0xe3, 0x82, 0xb9, 0xe3, 0x82, 0xbf, 0xe3, 0x83, 0x9f, 0xe3, 0x83, 0x8a, 0xe6, 0x80, 0xa5, 0xe9, 0x80, 0x9f, 0xe5, 0x9b, 0x9e, 0xe5, 0xbe, 0xa9, 0x10, 0x01, 0x0a, 0x16, 0x0a, 0x12, 0xe3, 0x82, 0xb8, 0xe3, 0x83, 0xa3, 0xe3, 0x83, 0xb3, 0xe3, 0x83, 0x97, 0xe9, 0x89, 0x84, 0xe4, 0xba, 0xba, 0x10, 0x02, 0x1a, 0x06, 0x08, 0x03, 0x10, 0x02, 0x18, 0x01]</pre>

11. 0x0Aとお守り全体の長さ(今回は62 = 0x3E)を先頭に追加します。これでバイト列が完成です。

<pre>[<b>0x0a, 0x3e</b>, 0x0a, 0x1c, 0x0a, 0x18, 0xe3, 0x82, 0xb9, 0xe3, 0x82, 0xbf, 0xe3, 0x83, 0x9f, 0xe3, 0x83, 0x8a, 0xe6, 0x80, 0xa5, 0xe9, 0x80, 0x9f, 0xe5, 0x9b, 0x9e, 0xe5, 0xbe, 0xa9, 0x10, 0x01, 0x0a, 0x16, 0x0a, 0x12, 0xe3, 0x82, 0xb8, 0xe3, 0x83, 0xa3, 0xe3, 0x83, 0xb3, 0xe3, 0x83, 0x97, 0xe9, 0x89, 0x84, 0xe4, 0xba, 0xba, 0x10, 0x02, 0x1a, 0x06, 0x08, 0x03, 0x10, 0x02, 0x18, 0x01]</pre>

12. バイト列をbase64エンコードします。これがお守りのインポート可能なテキストになります。

`Cj4KHAoY44K544K/44Of44OK5oCl6YCf5Zue5b6pEAEKFgoS44K444Oj44Oz44OX6YmE5Lq6EAIaBggDEAIYAQ==`
